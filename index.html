<html>
    <head>
        <title>Student Grade Table</title>
        <link href="styles.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body>
        <nav class="navigation">
            <a href="./dmindex.html" class="button">Dark Mode</a>
        </nav>
        <h1 class="header">Student Grade Table</h4>
        <table class="table" id="student-table">
            <thead>
                <tr>
                    <th><a href="#" id="thead-name">Name</a</th>
                    <th><a href="#" id="thead-grade">Grade</a></th>
                    <th>Options</th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr>
                    <td>
                        Name
                    </td>
                    <td>
                        Grade
                    </td>
                    <td>
                        <div class="option">
                            <button class="option-btn">...</button>
                            <div class="option-list">
                                <a href="#">Edit</a>
                                <a href="#">Delete</a>
                            </div>
                        </div>
                    </td>
                </tr> -->
            </tbody>
            <tfoot>
                <tr>
                    <form id="add-form">
                        <td><input id="name-input" type="text" size="8"
                                name="name"
                                placeholder="Name" /></td>
                        <td><input id="grade-input" type="number" size="3"
                                name="grade"
                                placeholder="Grade" /></td>
                        <td>
                            <div class="option">
                                <button class="option-btn" id="btn-add"
                                    type="submit">Add</button>
                            </div>
                        </td>
                    </form>
                </tr>
            </tfoot>
        </table>

        <script>
            let SORT = {
                UNSORTED: 1,
                INC: 2,
                DESC: 3,
            }
            let id = 5;
            let nameSorted = SORT.UNSORTED;
            let gradeSorted = SORT.UNSORTED;

            let students = [
                {id: 1, name: 'Hi there2', grade: 55},
                {id: 2, name: 'bye there2', grade: 31},
                {id: 3, name: 'cry here', grade: 75},
                {id: 4, name: 'go away', grade: 85},
            ];

            $(function() {
                const table = $('#student-table');
                const tbody = table.find('tbody');
                const newNameInput = $('#name-input');
                const newGradeInput = $('#grade-input');
                const addForm = $('#add-form');

                table.on('click', '.delete-btn', function(event) {
                    const rowId = parseInt(event.currentTarget.dataset.id);
                    students = students.filter(student => {
                        return student.id !== rowId;
                    });

                    $(event.currentTarget).parent().parent().parent().parent().remove();
                });

                table.on('submit', '.edit-form', function(event) {
                    event.preventDefault();
                    console.log('edit form submitted');
                });

                table.on('click', '.edit-btn', function(event) {
                    const rowId = parseInt(event.currentTarget.dataset.id);
                    const student = students.find(student => student.id === rowId);
                    const row = $(event.currentTarget).parent().parent().parent().parent();
                    const dothissparingly = `
                        <td>
                            <input type="text" name="name" value="${student.name}" />
                        </td>
                        <td>
                            <input type="number" name="grade" value="${student.grade}" />
                        </td>
                        <td>
                            <button class="reset-btn" data-id="${student.id}">Reset</button>
                            <button class="save-btn" data-id="${student.id}">Save</button>
                            <button class="cancel-btn" data-id="${student.id}">Cancel</button>
                        </td>
                `;

                    row.html(dothissparingly);
                });

                addForm.on('submit', function(event) {
                    event.preventDefault();

                    const newName = newNameInput.val();
                    const newGrade = newGradeInput.val();
                    const newId = Date.now();

                    students.push({
                        id: newId,
                        name: newName,
                        grade: newGrade,
                    });

                    addRow(newId, newName, newGrade);
                    newNameInput.val('');
                    newGradeInput.val('');
                });

                function addRow(id, name, grade) {
                    const row = $('<tr/>');
                    const colName = $('<td/>').text(name);
                    const colGrade = $('<td/>').text(grade);
                    const colOptions = $('<td/>').html(`
                        <div class="option">
                            <button class="option-btn">...</button>
                            <div class="option-list">
                                <a href="#" class="edit-btn" data-id="${id}">Edit</a>
                                <a href="#" class="delete-btn" data-id="${id}">Delete</a>
                            </div>
                        </div>
                    `);

                    row
                        .append(colName)
                        .append(colGrade)
                        .append(colOptions);

                    tbody.append(row);
                }

                students.forEach(student => {
                    addRow(student.id, student.name, student.grade);
                });

            });

        </script>
    </body>
</html>